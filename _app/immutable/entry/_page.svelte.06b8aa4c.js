var Z=Object.defineProperty;var D=(n,t,e)=>t in n?Z(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var h=(n,t,e)=>(D(n,typeof t!="symbol"?t+"":t,e),e);import{S as W,i as X,s as Y,J as tt,K as et,L as st,m as nt,h as H,n as A,b as it,M as ot,H as B,o as rt,w as at,y as lt,z as ct,A as ht,g as dt,d as ft,B as mt}from"../chunks/index.2ed2b89f.js";class gt{constructor(t,e){h(this,"camera");h(this,"entities");this.entities={players:new F(t==null?void 0:t.entities.players,e.entities.players),boxes:new F(t==null?void 0:t.entities.boxes,e.entities.boxes),lakes:new F(t==null?void 0:t.entities.lakes,e.entities.lakes)},JSON.stringify(t==null?void 0:t.camera)!=JSON.stringify(e.camera)&&(this.camera=e.camera)}}class F{constructor(t,e){h(this,"removed",[]);h(this,"updated",[]);h(this,"added",[]);if(t){for(const[s,i]of e)t.has(s)?JSON.stringify(t.get(s))!=JSON.stringify(i)&&this.updated.push([s,i]):this.added.push([s,i]);for(const s of t.keys())e.has(s)||this.removed.push(s)}else this.added=Array.from(e)}}class j{constructor(){h(this,"element");h(this,"x",0);h(this,"y",0);h(this,"degrees",0);this.element=document.createElementNS(K,"g")}content(t){this.element.innerHTML=t}position(t,e){this.x=t,this.y=e,this.updateTransform()}angle(t){this.degrees=t*180/Math.PI,this.updateTransform()}updateTransform(){this.element.setAttribute("transform",`translate(${this.x}, ${this.y}) rotate(${this.degrees})`)}}class ut{constructor(t){h(this,"image");this.image=new j,this.image.content(t.skin.image),this.update(t)}update(t){this.image.position(...t.position),this.image.angle(t.angle)}}const $=["#008080","#004455","#00222b"];class pt{constructor(t){h(this,"image");this.image=new j;const e=wt(t.polygon),s=`<path fill="${$[2]}" stroke="${$[2]}" d="${e}" style="stroke-width: 20;" transform="translate(-1 2) rotate(-3) scale(1.04 1.02)"/><path fill="${$[1]}" stroke="${$[1]}" d="${e}" style="stroke-width: 10;" transform="translate(2 4) rotate(1) scale(1.01 1.02)"/><path fill="${$[0]}" d="${e}" />`;this.image.content(s),this.update(t)}update(t){this.image.position(...t.position)}}function yt(n,t){const e=t[0]-n[0],s=t[1]-n[1];return{length:Math.sqrt(Math.pow(e,2)+Math.pow(s,2)),angle:Math.atan2(s,e)}}function J(n,t,e,s=!1){const i=n,o=t||i,r=e||i,a=.2,l=yt(o,r),c=s?Math.PI:0,f=i[0]+Math.cos(l.angle+c)*l.length*a,d=i[1]+Math.sin(l.angle+c)*l.length*a;return[f,d]}function wt(n){n=[...n,n[0]];let t=`M ${n[0][0]},${n[0][1]}`;for(let e=1;e<n.length;++e){const s=J(n[e-1],n[e-2]??n[n.length-2],n[e]),i=J(n[e],n[e-1],n[e+1]??n[1],!0);t+=` C ${s[0]},${s[1]} ${i[0]},${i[1]} ${n[e][0]},${n[e][1]}`}return t}function T(n=0,t=1){return Math.random()*(t-n)+n}class vt{constructor(t){h(this,"image");h(this,"eye");this.image=new j,this.image.content(t.skin.image);const e=this.image.element.getElementsByClassName("eye")[0];this.eye=new xt(e,1),this.update(t)}update(t){this.image.position(...t.position),this.image.angle(t.angle)}frame(){this.eye.transform(`translate(${T(-2,2)}, ${T(-2,2)}) rotate(${T(-20,20)})`)}}class xt{constructor(t,e){h(this,"element");h(this,"updateCooldown",0);h(this,"pastUpdateInstance",0);this.element=t,this.updateCooldown=e,this.element.setAttribute("style",`transition: all ${this.updateCooldown}s linear;`)}transform(t){const e=performance.now()/1e3;e-this.pastUpdateInstance>this.updateCooldown&&(this.pastUpdateInstance=e,this.element.setAttribute("transform",t))}}const K="http://www.w3.org/2000/svg";class kt{constructor(t,e){h(this,"loop",!0);h(this,"svg");h(this,"svgLayer");h(this,"entities");h(this,"server");h(this,"pastGameDrawed");this.svg=e,this.server=t,this.frame=this.frame.bind(this),this.entities={players:new Map,lakes:new Map,boxes:new Map},this.svgLayer=document.createElementNS(K,"g"),this.svg.appendChild(this.svgLayer),this.setup()}setup(){requestAnimationFrame(this.frame)}frame(){if(this.pastGameDrawed!=this.server.game){const t=new gt(this.pastGameDrawed,this.server.game);this.pastGameDrawed=this.server.game,this.updateCamera(t),this.updateEntities(t)}for(const t of this.entities.players.values())t.frame();this.loop&&requestAnimationFrame(this.frame)}updateCamera(t){if(t.camera){const e=t.camera.bottomRight[0]-t.camera.topLeft[0],s=t.camera.bottomRight[1]-t.camera.topLeft[1],i=this.svg.clientWidth,o=this.svg.clientHeight,r=Math.min(i/e,o/s),a=(i/r-e)/2-t.camera.topLeft[0],l=(o/r-s)/2-t.camera.topLeft[1];this.svgLayer.setAttribute("transform",`scale(${r}) translate(${a} ${l})`)}}updateEntities(t){var e,s,i;for(const[o,r]of t.entities.players.added){const a=new vt(r);this.entities.players.set(o,a),this.setupEntity(a)}for(const[o,r]of t.entities.players.updated)(e=this.entities.players.get(o))==null||e.update(r);for(const[o,r]of t.entities.boxes.added){const a=new ut(r);this.entities.boxes.set(o,a),this.setupEntity(a)}for(const[o,r]of t.entities.lakes.updated)(s=this.entities.lakes.get(o))==null||s.update(r);for(const[o,r]of t.entities.lakes.added){const a=new pt(r);this.entities.lakes.set(o,a),this.setupEntity(a)}for(const[o,r]of t.entities.lakes.updated)(i=this.entities.lakes.get(o))==null||i.update(r);for(const o of["players","boxes","lakes"])for(const r of t.entities[o].removed){const a=this.entities.players.get(r);a&&this.deleteEntity(a)}}setupEntity(t){this.svgLayer.appendChild(t.image.element)}deleteEntity(t){t.image.element.remove()}stop(){this.loop=!0}}function bt(n){let t,e,s;return tt(n[4]),{c(){t=et("svg"),this.h()},l(i){t=st(i,"svg",{width:!0,height:!0}),nt(t).forEach(H),this.h()},h(){A(t,"width",n[0]),A(t,"height",n[1])},m(i,o){it(i,t,o),n[5](t),e||(s=ot(window,"resize",n[4]),e=!0)},p(i,[o]){o&1&&A(t,"width",i[0]),o&2&&A(t,"height",i[1])},i:B,o:B,d(i){i&&H(t),n[5](null),e=!1,s()}}}function $t(n,t,e){let{server:s}=t,i,o,r;rt(()=>{const c=new kt(s,r);return()=>c.stop()});function a(){e(0,i=window.innerWidth),e(1,o=window.innerHeight)}function l(c){at[c?"unshift":"push"](()=>{r=c,e(2,r)})}return n.$$set=c=>{"server"in c&&e(3,s=c.server)},[i,o,r,s,a,l]}class Mt extends W{constructor(t){super(),X(this,t,$t,bt,Y,{server:3})}}const q=[{hitbox:[[[0,0],[147,142]]],image:`
<rect x="10" y="10" width="130" height="130" fill="#280b0b" />
<g fill="#784421">
    <rect id="rect6698-5" transform="matrix(1 .00019608 -.012423 .99992 0 0)" x="2.3151" y="1.239" width="65.081" height="63.743" rx="7.5469" ry="7.572" stop-color="#000000" style="paint-order:fill markers stroke"/>
    <rect id="rect7990-7-5" transform="matrix(1 .00019608 -.012423 .99992 0 0)" x="1.6738" y="78.51" width="139.49" height="63.743" rx="7.5469" ry="7.572" stop-color="#000000" style="paint-order:fill markers stroke"/>
    <rect id="rect7990-6-0" transform="matrix(1 .00019608 -.012423 .99992 0 0)" x="81.508" y="-.017463" width="65.081" height="142.27" rx="7.5469" ry="7.572" stop-color="#000000" style="paint-order:fill markers stroke"/>
</g>
`},{hitbox:[[[0,0],[310,164]]],image:`
<rect x="10" y="10" width="280" height="145" fill="#280b0b" />
<g fill="#784421">
    <rect id="rect6698-1-0" x="2.8814" y="1.445" width="73.372" height="73.372" rx="8.7326" ry="8.4924" stop-color="#000000" style="paint-order:fill markers stroke"/>
    <rect id="rect6698-1-9-1" x="98.342" y="1.445" width="120.04" height="73.372" rx="8.7326" ry="8.4924" stop-color="#000000" style="paint-order:fill markers stroke"/>
    <rect id="rect6698-1-9-5-1" x="147.12" y="90.389" width="120.04" height="73.372" rx="8.7326" ry="8.4924" stop-color="#000000" style="paint-order:fill markers stroke"/>
    <rect id="rect7990-7-3-6" x="-.002408" y="90.389" width="126.89" height="73.372" rx="8.7326" ry="8.4924" stop-color="#000000" style="paint-order:fill markers stroke"/>
    <rect id="rect7990-6-4-8" x="237.12" y="-.0012769" width="73.372" height="163.76" rx="8.7326" ry="8.4924" stop-color="#000000" style="paint-order:fill markers stroke"/>
</g>
`}],St=.5*(Math.sqrt(3)-1),M=(3-Math.sqrt(3))/6,R=n=>Math.floor(n)|0,U=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function _t(n=Math.random){const t=At(n),e=new Float64Array(t).map(i=>U[i%12*2]),s=new Float64Array(t).map(i=>U[i%12*2+1]);return function(o,r){let a=0,l=0,c=0;const f=(o+r)*St,d=R(o+f),m=R(r+f),y=(d+m)*M,Q=d-y,V=m-y,u=o-Q,p=r-V;let S,_;u>p?(S=1,_=0):(S=0,_=1);const P=u-S+M,L=p-_+M,E=u-1+2*M,G=p-1+2*M,z=d&255,N=m&255;let w=.5-u*u-p*p;if(w>=0){const g=z+t[N],k=e[g],b=s[g];w*=w,a=w*w*(k*u+b*p)}let v=.5-P*P-L*L;if(v>=0){const g=z+S+t[N+_],k=e[g],b=s[g];v*=v,l=v*v*(k*P+b*L)}let x=.5-E*E-G*G;if(x>=0){const g=z+1+t[N+1],k=e[g],b=s[g];x*=x,c=x*x*(k*E+b*G)}return 70*(a+l+c)}}function At(n){const e=new Uint8Array(512);for(let s=0;s<512/2;s++)e[s]=s;for(let s=0;s<512/2-1;s++){const i=s+~~(n()*(256-s)),o=e[s];e[s]=e[i],e[i]=o}for(let s=256;s<512;s++)e[s]=e[s-256];return e}var Ct=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},I={},Pt={get exports(){return I},set exports(n){I=n}};(function(n,t){(function(e,s){n.exports=s()})(Ct,function(){return e.importState=function(i){var o=new e;return o.importState(i),o},e;function e(){return function(i){var o=0,r=0,a=0,l=1;i.length==0&&(i=[+new Date]);var c=s();o=c(" "),r=c(" "),a=c(" ");for(var f=0;f<i.length;f++)o-=c(i[f]),o<0&&(o+=1),r-=c(i[f]),r<0&&(r+=1),a-=c(i[f]),a<0&&(a+=1);c=null;var d=function(){var m=2091639*o+l*23283064365386963e-26;return o=r,r=a,a=m-(l=m|0)};return d.next=d,d.uint32=function(){return d()*4294967296},d.fract53=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.version="Alea 0.9",d.args=i,d.exportState=function(){return[o,r,a,l]},d.importState=function(m){o=+m[0]||0,r=+m[1]||0,a=+m[2]||0,l=+m[3]||0},d}(Array.prototype.slice.call(arguments))}function s(){var i=4022871197,o=function(r){r=r.toString();for(var a=0;a<r.length;a++){i+=r.charCodeAt(a);var l=.02519603282416938*i;i=l>>>0,l-=i,l*=i,i=l>>>0,l-=i,i+=l*4294967296}return(i>>>0)*23283064365386963e-26};return o.version="Mash 0.9",o}})})(Pt);const Lt=I;function Et(n){const t=Lt(n),e=_t(t),s=8,i=2*Math.PI/s,o=80+200*t.next(),r=o*.6,a=o/300,l=new Array(s);let c=0;for(let f=0;f<s;++f){const d=Math.cos(c),m=Math.sin(c),y=o+r*e(d*a,m*a);l[f]=[y*d,y*m],c+=i}return l}const O=[{hitbox:[[[0,-18],[18,0],[0,18],[-18,0]]],image:'<path fill="$body" d="M0,-18 18,0 0,18 -18,0" /><rect class="eye" x="0" y="-5.5" width="11" height="11" fill="#000" />'},{hitbox:[[[15,-20],[15,20],[-20,0]]],image:'<polygon fill="$body" points="15,-20 15,20 -20,0" /><rect class="eye" x="0" y="-5.5" width="11" height="11" fill="#000" />'},{hitbox:[[[16,0],[-5,21],[-15.5,10.5],[-5,0],[-15.5,-10.5],[-5,-21]]],image:'<path fill="$body" d="M 16,0 -5,21 -15.5,10.5 -5,0 -15.5,-10.5 -5,-21" /><rect class="eye" x="0" y="-5.5" width="11" height="11" fill="#000" />'}],Gt=["#55ff55","#ff9955","#ffe680","#d35f8d"],C={get(n,t){return{hitbox:O[n].hitbox,image:O[n].image.replaceAll("$body",Gt[t])}}};function zt(){const n=[{user:{name:"A"},skin:C.get(0,0),position:[0,0],velocity:[0,0],angle:-.5,angular_velocity:0},{user:{name:"B"},skin:C.get(0,3),position:[-150,-100],velocity:[0,0],angle:0,angular_velocity:0},{user:{name:"C"},skin:C.get(1,2),position:[-250,-400],velocity:[0,0],angle:2,angular_velocity:0},{user:{name:"D"},skin:C.get(2,1),position:[300,400],velocity:[0,0],angle:-1,angular_velocity:0}],t=[{skin:q[1],position:[-500,200],angle:-.3},{skin:q[1],position:[400,-500],angle:1.2},{skin:q[0],position:[350,100],angle:.1}],e=[{position:[0,0],polygon:Et(Math.random())}];return{game:{camera:{topLeft:[-700,-500],bottomRight:[700,500]},entities:{players:new Map(n.map((s,i)=>[i,s])),boxes:new Map(t.map((s,i)=>[i,s])),lakes:new Map(e.map((s,i)=>[i,s]))}}}}function Nt(n){let t,e;return t=new Mt({props:{server:n[0]}}),{c(){lt(t.$$.fragment)},l(s){ct(t.$$.fragment,s)},m(s,i){ht(t,s,i),e=!0},p:B,i(s){e||(dt(t.$$.fragment,s),e=!0)},o(s){ft(t.$$.fragment,s),e=!1},d(s){mt(t,s)}}}function Ft(n){return[zt()]}class Bt extends W{constructor(t){super(),X(this,t,Ft,Nt,Y,{})}}export{Bt as default};
